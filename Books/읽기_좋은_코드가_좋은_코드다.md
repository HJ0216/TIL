# 읽기 좋은 코드가 좋은 코드다

📖 2024.03.24 -


## 1. 코드는 이해하기 쉬워야 한다
* 가독성의 기본 정리
    * 다른 사람이 코드를 자유롭게 수정하고, 버그를 짚어내고, 수정된 내용이 자신이 작성한 다른 부분의 코드와 어떻게 상호작용하는지 알 수 있어야 한다
    * 적은 분량으로 코드를 작성하는 것도 좋은 목표이지만, 이해를 위한 시간을 최소화하는 게 더 좋은 목표이다.



## 2. 이름에 정보 담기
* 특정한 단어 고르기
    * 구체적인 단어를 선택하기

|단어|대안|
|---|----|
|send|deliver, dispatch, announce, route|
|find|search, extract, locate, recover|
|start|launch, create, begin, open|
|make|create, set up, build, generate, compose, add, new|

* tmp나 retval 같은 보편적인 이름 피하기
    * 역할을 설명하는 변수를 사용하면 버그를 더 쉽게 찾아낼 수 있다.
    * tmp라는 이름은 짧게 임시적으로만 존재하고, 임시적 존재 자체가 변수의 가장 중요한 용도일 때에 한해서 사용해야 한다.

```cpp
if(clubs[i].members[k] == users[j])

// 반복문에서 여러개의 인덱스를 사용할 때, 명확한 의미를 들어내는 이름을 사용하면 버그를 찾아내기 쉽다.
if(clubs[club_i].members[member_i] == users[user_i])
```

* 추상적인 이름보다 구체적인 이름을 선호하라
* 추가적인 정보를 이름에 추가하기
    * 변수가 시간의 양이나 바이트 수 같은 측정치를 담고 있다면, 변수명에 단위를 포함시키는 게 도움이 된다.
    * 변수의 의미를 제대로 이해하는 것이 중요하다면 그 의미를 드러내는 정보를 이름에 포함시켜야 한다.

|함수|인수 단위를 포함하게 재작성|
|---|-------------------------|
|Start(int delay)|delay → delay_secs|
|Create(int size)|size → size_mb|
|ThrottleDownload(float limit)|limit → max_kbps|
|Rotate(float angle)|angle → degrees_cw|


|상황|변수명|더 나은 이름|
|---|------|-----------|
|패스워드가 plaintext에 담겨 있고, 추가적인 처리를 하기 전에 반드시 암호화되어야 한다.|password|plaintext_password|
|사용자에게 보여지는 설명문이 화면에 나타나기 전에 이스케이프처리 되어야 한다.|comment|unescaped_comment|
|html의 바이트가 UTF-8으로 변환되었다.|html|html_utf8|
|입력데이터가 url encoded 되었다.|data|data_urlenc|

* 이름은 얼마나 길어야 하는가
    * 좁은 범위에서만 사용되는 변수의 이름에 많은 정보를 담을 필요가 없다.
    * 어떤 이름이 클래스 변수이거나 전역 변수와 같은 큰 범위를 갖는다면, 이름에 의미를 분명하게 만들기 위한 정보를 충분히 포함해야 한다.
    * 불필요한 단어 제거하기

* 이름 포맷팅으로 의미를 전달하라
```cpp
static const int kMaxOpenFiles = 100;

class LogReader{
    public:
        void OpenFile(string local_file);
    private:
        int offset_;
        DISALLOW_COPY_AND_ASSIGN(LogReader);
}
```
```html
<div id="middle_column" class="main-content">
```



## 3. 오해할 수 없는 이름들
* 본인이 지은 이름을 다른 사람들이 다른 의미로 해석할 수 있을까라는 질문을 던져보며 철저하게 확인해야 한다.
    * Filter → Select / Exclude
    * Clip(text, length) → Truncate(text, max_chars)
* 경계를 포함하는 한계값을 다룰 때는 min/max를 사용하라
* 경계를 포함하는 범위에는 first/last를 사용하라
* 시작 경계는 포함하고, 끝 경계는 배제하는 범위에는 begin/end를 사용하라
* 불리언 변수에 이름 붙이기
    * is/has/can/should
    * 이름에서는 의미를 부정하는 용어를 피하는 것이 좋다.
* 사용자의 기대에 부응하기
    * get(): 가벼운 접근자로서 단순히 내부 멤버를 반환한다고 생각
    → 복잡한 계산 결과를 반환할 경우, get보다는 compute 등을 사용
* 어떤 이름을 정하기 전에 항상 최악의 상황을 가정하고 이름의 의미가 잘못 이해되는 가능성을 고려해봐야 한다.



## 4. 미학
* 코드를 읽는 사람이 이미 친숙한 일관성이 있는 레이아웃을 사용하라.
* 비슷한 코드는 서로 비슷해 보이게 만들어라.
* 서로 연관된 코드는 하나로 묶어라.

```java
public class PerformanceTester{
    public static final TcpConnectionSimulator wifi = 
        new TcpConnectionSimulator(
            500 /*Kbps*/
            , 80 /*millisecs 대기 시간*/
            , 200 /*흔들림*/
            , 1 /*패킷 손실*/
        );
    public static final TcpConnectionSimulator t3_fiber = 
        new TcpConnectionSimulator(
            45000 /*Kbps*/
            , 10 /*millisecs 대기 시간*/
            , 0 /*흔들림*/
            , 0 /*패킷 손실*/
        );
    public static final TcpConnectionSimulator cell = 
        new TcpConnectionSimulator(
            100 /*Kbps*/
            , 400 /*millisecs 대기 시간*/
            , 250 /*흔들림*/
            , 5 /*패킷 손실*/
        );
}
```
```java
public class PerformanceTester{
    // TcpConnectionSimulator(처리량, 지연속도, 흔들림, 패킷_손실)
    //                         kbps     ms      ms     percent 
    public static final TcpConnectionSimulator wifi = 
        new TcpConnectionSimulator(500, 80, 200, 1);
    public static final TcpConnectionSimulator t3_fiber = 
        new TcpConnectionSimulator(45000, 10, 0, 0);
    public static final TcpConnectionSimulator cell = 
        new TcpConnectionSimulator(100, 400, 250, 5);
}
```

* 메소드를 활용하여 불규칙성을 정리하라.
* 도움이 된다면 콛의 열을 맞춰라.
```cpp
DatabaseConnection database_connection;
string error;
assert(ExpandFullName(database_connection, "Doug Adams", &error) == "Mr. Douglas Adams");
assert(ExpandFullName(database_connection, "Jake Brown", &error) == "Mr. Jacob Brown III");
assert(error == "");
assert(ExpandFullName(database_connection, "No Such Guy", &error) == "");
assert(error == "no match found");
assert(ExpandFullName(database_connection, "John", &error) == "");
assert(error == "more than one result");
```
```cpp
CheckFullName("Doug Adams" , "Mr. Douglas Adams"  , "");
CheckFullName("Jake Brown" , "Mr. Jacob Brown III", "");
CheckFullName("No Such Guy", ""                   , "no match found");
CheckFullName("Doug Adams" , ""                   , "more than one result");

void CheckFullName(string partial_name
                   , string expected_full_name
                   , string expected_error){
    string error;
    string full_name = ExpandFullName(database_connection, partial_name, &error);
    assert(error == expected_error);
    assert(full_name == expected_full_name);
}
```

* 의미있는 순서를 선택하고 일관성 있게 사용하라.
    * 변수의 순서를 HTML 폼에 있는 \<input> 필드의 순서대로 나열하라.
    * 가장 중요한 것에서 시작해서 가장 덜 중요한 것까지 순서대로 나열하라.
    * 알파벳 순서대로 나열하라.

* 선언문을 블록으로 구성하라
* 코드를 문단으로 쪼개라

```cpp
class FrontendServer{
    public:
        FrontendServer();
        void ViewProfile(HttpRequest* request);
        void OpenDatabase(string location, string user);
        void SaveProfile(HttpRequest* request);
        string ExtractQueryParam(HttpRequest* request, string param);
        void ReplyOK(HttpRequest* request, string html);
        void FindFriends(HttpRequest* request);
        void ReplyNotFound(HttpRequest* request, string error);
        void CloseDatabase(string location);
        -FrontendServer();
}
```
```cpp
class FrontendServer{
    public:
        FrontendServer();
        -FrontendServer();

        // Handlers
        void ViewProfile(HttpRequest* request);
        void SaveProfile(HttpRequest* request);
        void FindFriends(HttpRequest* request);

        // Request/Response Utils
        string ExtractQueryParam(HttpRequest* request, string param);
        void ReplyOK(HttpRequest* request, string html);
        void ReplyNotFound(HttpRequest* request, string error);

        // Database Helpers
        void OpenDatabase(string location, string user);
        void CloseDatabase(string location);
}
```


## 5. 주석에 담아야 하는 대상
* 설명하지 말아야 하는 것
    * 코드에서 빠르게 유추할 수 있는 내용은 주석으로 달자 말라.
* 생각을 기록하라
    * 감독의 설명을 포함하라
    * 코드에 있는 결함을 설명하라
    * 상수에 대한 설명

```cpp
// 이 데이터에서 이진트리는 해시테이블보다 40% 정도 빠름
// → 코드 최적화를 위한 시간 소비를 줄여줌

// ResourceNode 하위 클래스를 만들어서 정리할 필요가 있음
// → 어떤 방향으로 수정해야하는지 안내
```
```cpp
// TODO: 더 빠른 알고리즘을 사용해야 함
```
```cpp
NUM_THREADS = 8 // 이 상수값이 2 * num_processor보다 크거나 같으면 됨
```


|표시|보통의 의미|
|---|-----------|
|TODO:|아직 하지 않은 일|
|FIXME:|오작동을 일으킨다고 알려진 코드|
|HACK:|아름답지 않은 해결책|
|XXX:|큰 문제가 있음|
|TextMate|ESC|

* 코드를 읽는 사람의 입장이 되어라
    * 나올 것 같은 질문 예측하기
    * 사람들이 쉽게 빠질 것 같은 함정을 경고하라
    * 큰 그림에 대한 주석

```cpp
// 외부 서비스를 호출해서 이메일 서비스를 호출(1분 이후 타임아웃)
void SendEmail(string to, string subject, string body);
```



## 6. 명확하고 간결한 주석 달기
* 주석은 간결하게 하라
* 모호한 대명사는 피하라
* 엉터리 문장을 다듬어라
* 함수의 동작을 명확하게 설명하라

```cpp
// 이 파일에 담긴 줄 수를 나타낸다.
// → 파일 안에 새 줄을 나타내는 바이트('\n')가 몇 개 있는지 센다.
int CountLines(string fileName){...}
```

* 코너케이스를 설명해주는 입출력 예를 설명하라
    * 지나치게 간단한 예는 유용하지 않음
```cpp
// 입력된 'src'의 'chars'라는 접두사와 접미사를 제거
// 예: Strip("abba/a/ba", "ab")는 "/a/"를 반환
String Strip(String src, String chars){...}
```

* 코드의 의도를 명시하라
* 이름을 가진 함수 파라미터 주석
















