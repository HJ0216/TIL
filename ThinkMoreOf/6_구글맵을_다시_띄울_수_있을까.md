# 6_êµ¬ê¸€ë§µì„_ë‹¤ì‹œ_ë„ìš¸_ìˆ˜_ìˆì„ê¹ŒğŸ¤”
ì¡°ê¸ˆ ë” ìƒê°í•´ ë³´ê³  ì‹¶ì€ ë¶€ë¶„ì„ ê³µë¶€í•œ ê¸€ì…ë‹ˆë‹¤.

- ì‘ì„±ì¼: 2023-12-31
- ìˆ˜ì •ì¼: 2024-01-03

<br/>



#
### ì£¼ì œë¥¼ ì„ ì •í•œ ì´ìœ 
ìµœì¢… Projectì—ì„œ Reactì—ì„œ GoogleMap êµ¬í˜„ì„ ë‹´ë‹¹í–ˆìŠµë‹ˆë‹¤.  
ë‹¹ì‹œì— ì‹œê°„ì´ ì´‰ë°•í•´ì„œ ì½”ë“œê°€ ëŒì•„ê°ˆ ìˆ˜ ìˆê²Œë§Œ í•˜ìëŠ” ê°ì˜¤ë¡œ ë§Œë“¤ì—ˆë˜ ì½”ë“œë¥¼ ë‹¤ì‹œ ê³µë¶€í•´ ë³´ê³ ì í–ˆìŠµë‹ˆë‹¤.  
ì—¬ì „íˆ í”„ë¡œì íŠ¸ ì§„í–‰ ë‹¹ì‹œì™€ ê°™ì€ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ê³  ìˆì§€ë§Œ, ì´ë²ˆì—ëŠ” ì •ë¦¬ë¥¼ ê¼¼ê¼¼í•˜ê²Œ í•´ë‘ê³ ì í•©ë‹ˆë‹¤.

<br/>



#
### Google Map API ë°œê¸‰
Maps JavaScript APIëŠ” ë¬´ë£Œ ë“±ê¸‰ ë‚´ì—ì„œ ë§¤ì›” 28,000íšŒì˜ í˜¸ì¶œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ì¼ì • ì‚¬ìš©ëŸ‰ì„ ì´ˆê³¼í•˜ë©´ ìš”ê¸ˆì´ ë¶€ê³¼ë˜ê¸° ë•Œë¬¸ì— API Keyë¥¼ ë°œê¸‰ë°›ê¸° ìœ„í•´ì„œëŠ” ì¹´ë“œ ë“±ë¡ì„ ë¨¼ì € ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.  
ì €ëŠ” í”„ë¡œì íŠ¸ ë‹¹ì‹œì— ì´ë¯¸ API Keyë¥¼ ë°œê¸‰ë°›ì•„ ë”°ë¡œ ì •ë¦¬í•˜ì§€ ì•Šê³ , ì°¸ê³  ì‚¬ì´íŠ¸ë§Œ ì¶”ê°€í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.  

 * [êµ¬ê¸€ì§€ë„ API í‚¤ ë°œê¸‰ ë°›ëŠ” ë°©ë²•.](https://duopix.co.kr/google-map-key/)

<br/>



#
### Google Map Load
ì €ëŠ” êµ¬ê¸€ë§µ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.  
@react-google-maps/api  
api ê³µì‹ ë¬¸ì„œì— ì‚¬ìš©ë²•ì´ ìì„¸íˆ ë‚˜ì™€ ìˆìŠµë‹ˆë‹¤.

1. package install

```bash
# npm
npm i -S @react-google-maps/api

# yarn
yarn add @react-google-maps/api
```

2. execute sample code  

```javascript
import React from 'react'
import { GoogleMap, useJsApiLoader } from '@react-google-maps/api';

const containerStyle = {
  width: '400px',
  height: '400px'
};

const center = {
  lat: -3.745,
  lng: -38.523
};

function MyComponent() {
  const { isLoaded } = useJsApiLoader({
    id: 'google-map-script',
    googleMapsApiKey: "YOUR_API_KEY"
  })

  const [map, setMap] = React.useState(null)

  const onLoad = React.useCallback(function callback(map) {
    // This is just an example of getting and using the map instance!!! don't just blindly copy!
    const bounds = new window.google.maps.LatLngBounds(center);
    map.fitBounds(bounds);

    setMap(map)
  }, [])

  const onUnmount = React.useCallback(function callback(map) {
    setMap(null)
  }, [])

  return isLoaded ? (
      <GoogleMap
        mapContainerStyle={containerStyle}
        center={center}
        zoom={10}
        onLoad={onLoad}
        onUnmount={onUnmount}
      >
        { /* Child components, such as markers, info windows, etc. */ }
        <></>
      </GoogleMap>
  ) : <></>
}

export default React.memo(MyComponent)
```

"YOUR_API_KEY" ë¶€ë¶„ì€ ë°œê¸‰ë°›ì€ API key ê°’ì„ ì…ë ¥í•´ ì£¼ë©´ ë©ë‹ˆë‹¤.  
í•˜ì§€ë§Œ, í•´ë‹¹ ì½”ë“œë¥¼ git ì €ì¥ì†Œì— ì½”ë“œë¥¼ ì˜¬ë¦´ ê²½ìš° API Keyê°€ ë…¸ì¶œë  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.  
ê·¸ëŸ¬ë¯€ë¡œ .env íŒŒì¼ì„ ì´ìš©í•´ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

```javascript
  const { isLoaded } = useJsApiLoader({
    id: 'google-map-script',
    googleMapsApiKey: "YOUR_API_KEY"
  })
  
  // using .env
  const { isLoaded } = useJsApiLoader({
    id: 'google-map-script',
    googleMapsApiKey: `${process.env.REACT_APP_GOOGLE_MAP_API_KEY}`
  })

```

.env ì„¤ì •ê³¼ ê´€ë ¨í•´ì„œëŠ” ì•„ë«ê¸€ì„ ì°¸ê³ í•´ ë³´ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.

 * [# 5_dotenvëŠ”_ë¬´ì—‡ì¼ê¹Œ](https://hj0216.tistory.com/882)

API Keyë¥¼ ì œëŒ€ë¡œ ì…ë ¥í•œ ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì€ êµ¬ê¸€ ì§€ë„ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

![default_google_map](./images/6/default_google_map.png)

<br/>



#
### Google Map Marker
React 18 ì´í›„ì—ëŠ” Marker ëŒ€ì‹  MarkerFë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.  
ìœ„ì¹˜ëŠ” GoogleMap Component ì‚¬ì´ì…ë‹ˆë‹¤.

```javascript
<GoogleMap>
	...
	<MarkerF
		onLoad={onLoad}
		position={{ lat: center.lat , lng: center.lng }}
        icon={{
        	url: `${process.env.PUBLIC_URL}/images/heart_plus.svg`,
        	scaledSize: new window.google.maps.Size(32, 32),
		}}
	/>
	...
<GoogleMap />

```

ì´ë ‡ê²Œ ì…ë ¥ì„ í•œ í›„, ì‹¤í–‰ì„ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

```bash
map.fitBounds is not a function
TypeError: map.fitBounds is not a function
...

```

ì˜ ì‘ë™í•˜ë˜ map.fitBoundsê°€ í•¨ìˆ˜ê°€ ì•„ë‹ˆë¼ëŠ” ì˜¤ë¥˜ì…ë‹ˆë‹¤.  
ë¦¬ì•¡íŠ¸ì—ì„œëŠ” ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì € ë©€ë¦¬ì„œ ë´ë„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤ğŸ¤¹.

![react_error](./images/6/react_error.png)

ë¬¸ì œëŠ” <MarkerF> ì•ˆì˜ onload ì†ì„± ë•Œë¬¸ì…ë‹ˆë‹¤.  
ë§Œì¼ onload ì†ì„±ì„ ì£¼ì„ ì²˜ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë§ˆì»¤ê°€ ì§€ë„ì— í‘œì‹œë©ë‹ˆë‹¤.

![google_map_marker](./images/6/google_map_marker.png)

MarkerF ì»´í¬ë„ŒíŠ¸ì˜ onLoad optionì— onload ë³€ìˆ˜ë¥¼ ì¸ìë¡œ ë„˜ê²¨ì£¼ì—ˆìŠµë‹ˆë‹¤.  
ì •í™•íˆëŠ” ì•„ë˜ ë³€ìˆ˜ë¥¼ onLoad option ê°’ìœ¼ë¡œ ì„¤ì •í•œ ê²ƒì…ë‹ˆë‹¤.

```javascript
const onLoad = React.useCallback(function callback(map) {
  const bounds = new window.google.maps.LatLngBounds(center);
  map.fitBounds(bounds);

  setMap(map)
}, [])
```

Google Maps APIëŠ” <GoogleMap>ì´ ë¡œë“œë  ë•Œ onLoad í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ Map ê°ì²´ë¥¼ ì¸ìë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.  
ê·¸ë˜ì„œ ìœ„ì—ì„œ ì •ì˜í•œ onLoad í•¨ìˆ˜ë¥¼ GoogleMap ì»´í¬ë„ŒíŠ¸ì˜ onLoad ì†ì„±ì— ì „ë‹¬í•˜ëŠ” ê²ƒì´ ë¬¸ì œê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ê·¸ëŸ¬ë‚˜ <MarkerF>ê°€ ë¡œë“œë  ë•ŒëŠ” onload í•¨ìˆ˜ í˜¸ì¶œ ì‹œ, Marker ê°ì²´ë¥¼ ì „ë‹¬í•˜ê¸° ë•Œë¬¸ì— Map ê°ì²´ë¥¼ ì¸ìë¡œ ë°›ëŠ” onload ê°’ì„ ë„˜ê¸°ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.  
ë”°ë¼ì„œ Map ê°ì²´ê°€ ì•„ë‹ˆë¯€ë¡œ fitBoundsì™€ ê°™ì€ functionë„ ì—†ìœ¼ë¯€ë¡œ ìœ„ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.  

ë§ˆì»¤ë¥¼ í‘œì‹œí•˜ê¸´ í–ˆì§€ë§Œ, ì—¬í–‰ ì¼ì •ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ í•œ ê°œë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í•˜ê¸°ì— ì—¬ëŸ¬ ê°œì˜ ë§ˆì»¤ë¥¼ ì°ì–´ë³´ê² ìŠµë‹ˆë‹¤.  

```javascript
{
  mapData
  .filter((item) => item.placeOrder !== null)
  .map((item) => (
    <MarkerF
        key={item.placeOrder}
        position={{ lat: item.center.lat , lng: item.center.lng }}
        icon={{
          url: `${process.env.PUBLIC_URL}/images/counter_${item.placeOrder}.svg`,
          scaledSize: new window.google.maps.Size(24, 24),
        }}
      />
))}

```

ë°ì´í„° í˜•ì‹ì— ë”°ë¼ ì½”ë“œê°€ ì¼ë¶€ ìˆ˜ì •ë  ìˆ˜ ìˆê² ì§€ë§Œ, ì¤‘ìš”í•œ ê²ƒì€ <MarkerF>ë¥¼ ë°˜ë³µë¬¸ìœ¼ë¡œ ëŒë ¤ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.  
ì €ëŠ” ì—¬í–‰ì˜ ìˆœì„œë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•´ ì•„ì´ì½˜ íŒŒì¼ ì´ë¦„ê³¼ ìˆœë²ˆì„ ê²°í•©í•˜ì˜€ìŠµë‹ˆë‹¤.  
ì˜ˆë¥¼ ë“¤ì–´ ì²« ë²ˆì§¸ ëª©ì ì§€ëŠ” ìˆœë²ˆì´ 1ì´ê³ , ì•„ì´ì½˜ íŒŒì¼ ì´ë¦„ì„ counter_1ë¡œ ì„¤ì •í•´ ì—¬í–‰ ìˆœë²ˆì— ë”°ë¼ ì•„ì´ì½˜ì´ í‘œì‹œë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

![google_map_makers](./images/6/google_map_makers.png)

<br/>



#
### Google Map Polyline
ì´ì œ ê±°ì˜ ë‹¤ ì™”ìŠµë‹ˆë‹¤.  
ê°œëµì ì¸ ì—¬í–‰ì§€ ê°„ì˜ ê±°ë¦¬ë¥¼ ê°€ì‹œì ìœ¼ë¡œ í‘œí˜„í•˜ê¸° ìœ„í•´ ì ì„ ì„ ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤.  
ê¸°ì¡´ì— ì§„í–‰í–ˆë˜ Polyline ì„¤ì • ì½”ë“œê°€ ìˆìœ¼ë¯€ë¡œ ë¹ ë¥´ê²Œ ë³µì‚¬ + ë¶™ì—¬ë„£ê¸°ë¥¼ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤.  
ê·¸ë¦¬ê³  ë‹¤ì‹œ ë§Œë‚œ ì—ëŸ¬!

```javascript
const onLoad = React.useCallback(function callback(map) {
    const bounds = new window.google.maps.LatLngBounds(center);
    map.fitBounds(bounds);

    polyline.setMap(map)

    setMap(map)

  }, [])

const polyline = new window.google.maps.Polyline({
  path: coordinates,
  strokeColor: '#555555',
  strokeOpacity: 0,
  strokeWeight: 0.7,

  icons: [
    {
      icon: lineSymbol,
      offset: '0',
      repeat: '15px', // ì‹¤ì„ ê³¼ ì‹¤ì„  ì‚¬ì´ ê¸¸ì´
    },
  ],
})  

```

![react_error_2](./images/6/react_error_2.png)

Cannot read properties of undefined (reading 'maps')  
new window.google.maps.Polylineì—ì„œ mapsê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ë‹¤ê³  ë‚˜ì˜¤ëŠ” ì˜¤ë¥˜ì…ë‹ˆë‹¤. ë¶„ëª… ë§µì˜ ì‹œì‘ ìœ„ì¹˜ë¥¼ ì¡ì•„ì¤„ ë•Œë„, Markerë¥¼ ë§Œë“¤ ë•Œë„ ë‚˜ì˜¤ì§€ ì•Šì•˜ë˜ ì˜¤ë¥˜ì¸ë° polylineì—ì„œë§Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.  
ì—´ì‹¬íˆ êµ¬ê¸€ë§í•˜ë˜ ì¤‘ ì €ì˜ í´ë¦¬ë¼ì¸ê³¼ ë‹¤ë¥¸ ë¶„ì˜ í´ë¦¬ë¼ì¸ ë³€ìˆ˜ ì„ ì–¸ ìœ„ì¹˜ê°€ ì•½ê°„ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.  
ê·¸ë˜ì„œ ìœ„ì¹˜ë¥¼ ì´ë™ì‹œì¼°ëŠ”ë°,

```javascript
const onLoad = React.useCallback(function callback(map) {
  const bounds = new window.google.maps.LatLngBounds(center);
  map.fitBounds(bounds);

  const polyline = new window.google.maps.Polyline({
    path: coordinates,
    strokeColor: '#555555',
    strokeOpacity: 0,
    strokeWeight: 0.7,

    icons: [
      {
        icon: lineSymbol,
        offset: '0',
        repeat: '15px', // ì‹¤ì„ ê³¼ ì‹¤ì„  ì‚¬ì´ ê¸¸ì´
      },
    ],
  })

  polyline.setMap(map)

  setMap(map)

}, [])

```

![google_map_polyline](./images/6/google_map_polyline.png)

..? ì ì„ ì´ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.  
ì´ì— ëŒ€í•´ ì–´ë–¤ ì°¨ì´ê°€ ìˆì–´ì„œ ì‹¤í–‰ëœê±´ì§€ í™•ì¸í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

window.google.maps ê°ì²´ëŠ” Google Mapsê°€ ì™„ì „íˆ ë¡œë“œë  ë•Œê¹Œì§€ ì •ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ê·¸ëŸ¬ë‚˜, Google MapsëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ë¡œë“œë˜ë¯€ë¡œ, ì‹¤í–‰ ìˆœì„œê°€ Google Maps ë¡œë“œ -> window.google.maps ê°ì²´ í˜¸ì¶œì´ ë˜ë„ë¡ ë³´ì¥í•´ì•¼ í•©ë‹ˆë‹¤.  
onLoad ì½œë°± í•¨ìˆ˜ëŠ” Google Mapsê°€ ë¡œë“œë˜ì—ˆì„ ë•Œ í˜¸ì¶œë˜ë©°, ê·¸ ì•ˆì—ì„œ window.google.maps.Polylineì„ ì‚¬ìš©í•˜ì—¬ í´ë¦¬ë¼ì¸ì„ ë§Œë“¤ê³ , ê·¸ í´ë¦¬ë¼ì¸ì„ ë§µì— ì¶”ê°€í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.  
ì´ë ‡ê²Œ í•˜ë©´ window.google.maps ê°ì²´ê°€ ì´ë¯¸ ì¤€ë¹„ë˜ì—ˆìŒì„ ë³´ì¥í•˜ë¯€ë¡œ, ì´ì „ì— ë°œìƒí–ˆë˜ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br/>



#
### ì •ë¦¬
6_êµ¬ê¸€ë§µì„_ë‹¤ì‹œ_ë„ìš¸_ìˆ˜_ìˆì„ê¹ŒğŸ¤”  
ë„ìš¸ ìˆ˜ ìˆë‹¤ğŸ¤“

êµ¬ê¸€ ë§µ API ì‚¬ìš© ì‹œ, ìœ ì˜ì 
  - ì¼ì • ì‚¬ìš©ëŸ‰ ì´ìƒë¶€í„°ëŠ” ìœ ë£Œì´ë¯€ë¡œ, í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ API Key ê´€ë¦¬
  - Google Mapsê°€ ë¡œë“œë˜ê³  ë‚œ í›„, new window.google.mapsê°€ í˜¸ì¶œë˜ë„ë¡ ì‹¤í–‰ ìˆœì„œ ë³´ì¥

<br/>



#
### ê¸°íƒ€
- onloadì™€ useCallback
useCallbackì„ í†µí•´ callbackí•¨ìˆ˜ë¥¼ memoization, ì¦‰ íŠ¹ì • í•¨ìˆ˜ë¥¼ ì €ì¥í•´ë‘ê³  ì¬ì‚¬ìš©í•˜ëŠ” ìµœì í™”ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.  
useCallbackì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´, ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ onLoad í•¨ìˆ˜ê°€ ìƒì„±ë˜ì–´ ë¶ˆí•„ìš”í•œ ë©”ëª¨ë¦¬ ì‚¬ìš©ê³¼ ì„±ëŠ¥ ì €í•˜ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ê·¸ë¡œë¯€ë¡œ useCallbackì„ ì‚¬ìš©í•˜ì—¬ onLoad í•¨ìˆ˜ë¥¼ ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë Œë”ë§ë  ë•Œ í•œ ë²ˆë§Œ ìƒì„±í•˜ê³ , ê·¸ ì´í›„ì—ëŠ” ì´ì „ì— ìƒì„±ëœ í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ ì„±ëŠ¥ì„ ê°œì„ ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

<br/>


#
### ğŸ“šì°¸ê³  ìë£Œ
[Google Maps Platform FAQ](https://developers.google.com/maps/faq?hl=ko)  
[êµ¬ê¸€ì§€ë„ API í‚¤ ë°œê¸‰ ë°›ëŠ” ë°©ë²•.](https://duopix.co.kr/google-map-key/)  
[@react-google-maps/api](https://www.npmjs.com/package/@react-google-maps/api)  
[# 5_dotenvëŠ”_ë¬´ì—‡ì¼ê¹Œ](https://hj0216.tistory.com/882)  
[[React] react-google-map/api GoogleMap/MarkerF/InfoWindowF ì‚¬ìš©](https://velog.io/@sanggyo/React-react-google-mapapi-GoogleMapMarkerFInfoWindowF-%EC%82%AC%EC%9A%A9)  
[Using the Public Folder](https://create-react-app.dev/docs/using-the-public-folder/)  
[êµ¬ê¸€ë§µ - í´ë¦¬ë¼ì¸ & í´ë¦¬ê³¤ ê·¸ë¦¬ê¸°](https://secr.tistory.com/95)  
[Maps JavaScript APIì˜ ìŠ¤íƒ€ì¼ ì°¸ì¡°](https://developers.google.com/maps/documentation/javascript/style-reference?hl=ko#style-features)
